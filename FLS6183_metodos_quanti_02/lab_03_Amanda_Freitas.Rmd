```{r message=FALSE, warning=FALSE, include=FALSE}
# install.packages("corrplot")
# install.packages("lmtest")
# install.packages("olsrr")
# install.packages("stargazer")

library(lmtest)
library(olsrr)
library(corrplot)
library(tidyverse)
library(stargazer)
library(broom)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
dados <- read.csv("base_lab_03.csv")
head(dados)
```

4)	Rode quatro modelos introduzindo uma variável dependente por vez – primeiro x1, depois x2 - e depois as dependentes juntas x1 e x2, depois x1, x2 e c1 apenas. O que acontece com os coeficientes destas variáveis entre os modelos? Discuta;

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=TRUE}
modelo01 <- 
  dados %>% 
  lm(y1 ~ x1, data = .)

modelo02 <- 
  dados %>% 
  lm(y1 ~ x2, data = .)

modelo03 <- 
  dados %>% 
  lm(y1 ~ x1 + x2, data = .)

modelo04 <- 
  dados %>% 
  lm(y1 ~ x1 + x2 + c1, data = .)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
tidy(modelo01)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
tidy(modelo02)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
tidy(modelo03)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
tidy(modelo04)
```


```{r, results='asis'}
stargazer(modelo01, modelo02, modelo03, modelo04, 
          type = "html",
          digits =  2)
```

Com a introdução das variáveis X2. c1 e c2. a variável x1 diminui em significância estatística, mas a x2 mantém coeficiente próximo e mantém significancia estatística.





5)	Agora rode um quinto modelo completo com as duas variáveis explicativas e as duas variáveis de controle. O que acontece com os coeficientes agora? Você detecta alguma alteração importante? Quais seriam os motivos?

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=TRUE}
modelo05 <- 
  dados %>% 
  lm(y1 ~ x1 + x2 + c1 +c2, data = .)
```

```{r, results='asis'}
stargazer(modelo01, modelo02, modelo03, modelo04, modelo05,
          type = "html",
          digits = 3)
```

A variável x1 agora não tem mais significância estatística e diminuiu muito em significância, mudou de sinal, e x2 perdeu um pouco de significância.






6)	Procure na lista de comandos do R para a aula de hoje um que permita checar se a suposta causa do comportamento observado considerado no item anterior.

```{r include=FALSE}
residuos_modelo_01 <- modelo01$residuals
residuos_modelo_02 <- modelo02$residuals
residuos_modelo_03 <- modelo03$residuals
residuos_modelo_04 <- modelo04$residuals
residuos_modelo_05 <- modelo05$residuals
```

Com essa informação, podemos contruir um gráfico para analisar nossos resíduos em comparação aos valores previstos pelo modelo usando o ggplot.

```{r message=FALSE, warning=FALSE, include=FALSE}
preditos_modelo_01 <- predict(modelo01)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
residuos_fitted_modelo01 <- 
  cbind(residuos_modelo_01, preditos_modelo_01) %>%
  as.data.frame()

residuos_fitted_modelo_01_residuos <- 
  as.data.frame(residuos_modelo_01)
```

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
ggplot(residuos_fitted_modelo01, aes(x = preditos_modelo_01, y = residuos_modelo_01)) +
  geom_point() + 
  stat_smooth(method='lm')
```


Há um outro teste necessário a ser feito com o intuito de se certificar de que não há violação às hipóteses básicas do modelo MQO. 

7)	Rode um modelo multivariado Y = f (X2, C1, C2), primeiro apenas com a única variável explicativa x2 e depois, incluindo os controles. Escreva a nova equação estimada;

```{r message=FALSE, warning=FALSE, include=FALSE}
modelo_07 <- 
  dados %>% 
  lm(y1 ~ x2, data = .)
  
modelo_06 <- 
dados %>% 
lm(y1 ~ x2 + c1 + c2, data = .)
```


8)	Construa um gráfico de dispersão que relacione a variável explicativa com os resíduos. O que é possível notar neste gráfico a respeito da relação entre ambas as variáveis?


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
#Também podemos tirar um gráfico de dispersão entre resíduos e os valores previstos pelo modelo apenas com a função plot(). (Considere apenas o gráfico Residuals vs Fitted)
plot(modelo_06)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
plot(modelo_07)
```


9)	Encontre um outro teste entre os comandos para a aula de hoje que permita testar se esta outra hipótese foi ou não violada. Reporte os resultados. Qual sua conclusão?

Para verificar a matriz de correlação entre as variáveis de uma tabela, usamos:
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
corrplot(cor(dados), 
         method = "number",
         title = "Matriz de correlação entre as variáveis")
```



